<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>宇浩输入法·常用字练习</title>
    <style media="screen, print">
        @font-face {
            font-family: 'YuhaoSongti';
            src: url("./fonts/YuhaoSongti.ttf");
        }

        body {
            font-family: "YuhaoSongti", serif;
        }
    </style>
    <script style="font-family: YuhaoSongti;">
        var root_map = [
            // 1-50
            {
                "ewod": ["的〔白丶〕"],
                "fif": ["一〔一〕"],
                "jfnh": ["是〔日一龰〕"],
                "vlf": ["了〔了〕"],
                "duf": ["不〔不〕"],
                "snhv": ["在〔丨土〕"],
                "swv": ["有〔月〕"],
                "tns": ["个〔人丨〕"],
                "tef": ["人〔人〕"],
                "ppow": ["这〔文辶〕"],
            },
            {
                "ksf": ["上〔上〕"],
                "lns": ["中〔口丨〕"],
                "gdf": ["大〔大〕"],
                "oxod": ["为〔丶力丶〕"],
                "fpmi": ["来〔一米〕"],
                "qagg": ["我〔丿扌戈〕"],
                "hmdk": ["到〔至刂〕"],
                "xxaa": ["出〔屮凵〕"],
                "dcvi": ["要〔覀女〕"],
                "xote": ["以〔乚丶人〕"],
            },
            {
                "jac": ["时〔日寸〕"],
                "rlvh": ["和〔禾口〕"],
                "hcy": ["地〔土也〕"],
                "epn": ["们〔亻门〕"],
                "rjfa": ["得〔彳日一寸〕"],
                "alvn": ["可〔丁口〕"],
                "akf": ["下〔下〕"],
                "bacu": ["对〔又寸〕"],
                "wgf": ["生〔生〕"],
                "cyf": ["也〔也〕"],
            },
            {
                "vkf": ["子〔子〕"],
                "olmd": ["就〔亠口小尤〕"],
                "apoc": ["过〔寸辶〕"],
                "vwrr": ["能〔厶月匕匕〕"],
                "ecy": ["他〔亻也〕"],
                "tsvv": ["会〔人二厶〕"],
                "rrkk": ["多〔夕夕〕"],
                "xeod": ["发〔乚夂丶〕"],
                "oulq": ["说〔讠丷口儿〕"],
                "srf": ["而〔而〕"],
            },
            {
                "faui": ["于〔一〕"],
                "tkf": ["自〔自〕"],
                "pcf": ["之〔之〕"],
                "tnf": ["用〔用〕"],
                "qav": ["年〔〕"],
                "rahc": ["行〔彳亍〕"],
                "ods": ["家〔宀豕〕"],
                "ogf": ["方〔方〕"],
                "eflv": ["后〔一口〕"],
                "eqmo": ["作〔亻〕"],
            },
            // 51-100
            {
                "dviw": ["成〔戊{顺折同乙}〕"],
                "fsoi": ["开〔一卄〕"],
                "gif": ["面〔面〕"],
                "alxv": ["事〔{于下}口彐〕"],
                "cvk": ["好〔女子〕"],
                "maf": ["小〔小〕"],
                "ynf": ["心〔心〕"],
                "uwmd": ["前〔䒑月刂〕"],
                "iejh": ["所〔{戶同户}斤〕"],
                "utpo": ["道〔䒑自辶〕"],
            },
            {
                "ihvv": ["法〔氵土厶〕"],
                "clv": ["如〔女口〕"],
                "stpo": ["进〔二{介下同八}辶〕"],
                "ynf": ["着〔心〕"],
                "kflv": ["同〔冂一口〕"],
                "vbfo": ["经〔纟{ス同又}工〕"],
                "tbdb": ["分〔八刀〕"],
                "ofnh": ["定〔宀一龰〕"],
                "hjcf": ["都〔耂日阝〕"],
                "uwuh": ["然〔月犬灬〕"],
            },
            {
                "sfik": ["与〔丂一〕"],
                "ffi": ["本〔木一〕"],
                "dpou": ["还〔不辶〕"],
                "dqf": ["其〔其〕"],
                "mxva": ["当〔小彐〕"],
                "dbjk": ["起〔走己〕"],
                "svxl": ["动〔二厶力〕"],
                "bif": ["已〔已〕"],
                "fktt": ["两〔一冂人人〕"],
                "mluh": ["点〔卜口灬〕"],
            },
            {
                "ttee": ["从〔人人〕"],
                "plvn": ["问〔门口〕"],
                "ksej": ["里〔甲二〕"],
                "ogvd": ["主〔丶王〕"],
                "osgd": ["实〔宀{两点同二}大〕"],
                "fgdi": ["天〔一大〕"],
                "olkl": ["高〔亠口冂口〕"],
                "hvv": ["去〔土厶〕"],
                "gkx": ["现〔王见〕"],
                "thf": ["长〔长〕"],
            },
            {
                "nrii": ["此〔止匕〕"],
                "faf": ["三〔三〕"],
                "urac": ["将〔丬夕寸〕"],
                "fdoi": ["无〔一尢〕"],
                "ngod": ["国〔囗王丶〕"],
                "tgve": ["全〔人王〕"],
                "pwf": ["文〔文〕"],
                "gkse": ["理〔王甲二〕"],
                "jwv": ["明〔日月〕"],
                "jvf": ["日〔日〕"],
            },
            // 101-150
            {
                "": [""],
                "": [""],
                "": [""],
                "": [""],
                "": [""],
                "": [""],
                "": [""],
                "": [""],
                "": [""],
                "": [""],
            },
            {
                "": [""],
                "": [""],
                "": [""],
                "": [""],
                "": [""],
                "": [""],
                "": [""],
                "": [""],
                "": [""],
                "": [""],
            },
            {
                "": [""],
                "": [""],
                "": [""],
                "": [""],
                "": [""],
                "": [""],
                "": [""],
                "": [""],
                "": [""],
                "": [""],
            },
            {
                "": [""],
                "": [""],
                "": [""],
                "": [""],
                "": [""],
                "": [""],
                "": [""],
                "": [""],
                "": [""],
                "": [""],
            },
            {
                "": [""],
                "": [""],
                "": [""],
                "": [""],
                "": [""],
                "": [""],
                "": [""],
                "": [""],
                "": [""],
                "": [""],
            },
            {
                "": [""],
                "": [""],
                "": [""],
                "": [""],
                "": [""],
                "": [""],
                "": [""],
                "": [""],
                "": [""],
                "": [""],
            },
            {
                "": [""],
                "": [""],
                "": [""],
                "": [""],
                "": [""],
                "": [""],
                "": [""],
                "": [""],
                "": [""],
                "": [""],
            },
            {
                "": [""],
                "": [""],
                "": [""],
                "": [""],
                "": [""],
                "": [""],
                "": [""],
                "": [""],
                "": [""],
                "": [""],
            },
            {
                "": [""],
                "": [""],
                "": [""],
                "": [""],
                "": [""],
                "": [""],
                "": [""],
                "": [""],
                "": [""],
                "": [""],
            },
            {
                "": [""],
                "": [""],
                "": [""],
                "": [""],
                "": [""],
                "": [""],
                "": [""],
                "": [""],
                "": [""],
                "": [""],
            },
            {
                "": [""],
                "": [""],
                "": [""],
                "": [""],
                "": [""],
                "": [""],
                "": [""],
                "": [""],
                "": [""],
                "": [""],
            },
            {
                "": [""],
                "": [""],
                "": [""],
                "": [""],
                "": [""],
                "": [""],
                "": [""],
                "": [""],
                "": [""],
                "": [""],
            },
            {                
                "": [""],
                "": [""],
                "": [""],
                "": [""],
                "": [""],
                "": [""],
                "": [""],
                "": [""],
                "": [""],
                "": [""],
            },
            {
                "": [""],
                "": [""],
                "": [""],
                "": [""],
                "": [""],
                "": [""],
                "": [""],
                "": [""],
                "": [""],
                "": [""],
            },
            {
                "": [""],
                "": [""],
                "": [""],
                "": [""],
                "": [""],
                "": [""],
                "": [""],
                "": [""],
                "": [""],
                "": [""],
            },
        ]

        function main() {
            raw_area = document.getElementById("raw_area")
            user_input = document.getElementById("user_input")
            main_top = document.getElementById("maintop")
            main_bot = document.getElementById("mainbot")
            speed_label = document.getElementById("speedlabel")
            total_label = document.getElementById("totallabel")
            speed_timer = null
            word_count = 0
            start_time = 0
            cur_input_max = 0
            cur_input_index = 0
            cur_tab = 0
            total_words = []
            total_index = 0
            max_words_count = 0
            wrong_words = []

            // display_help()
            choose_root(1)
        }

        function display_release_note() {
            reset_timer()
            clear_tabs_background(999)
            clear_raw_area()
            enable_user_input(false)
            raw_area.style.fontSize = "16px"
            raw_area.style.fontHeight = "16px"
            var span = document.createElement("span")
            span.innerText = hereDoc(function () {/*

原作者：MoGu

2023年3月24日：
本为徐码字根，现移植宇浩字根。
    */})
            raw_area.appendChild(span)
        }

        function display_help() {
            reset_timer()
            clear_tabs_background(0)
            clear_raw_area()
            enable_user_input(false)
            raw_area.style.fontSize = "16px"
            raw_area.style.fontHeight = "16px"
            var span = document.createElement("span")
            span.innerText = hereDoc(function () {/*
宇浩输入法规则

定义：
- A 为首根大码，a 为首根小码。
- B 为第二根大码，b 为第二根小码。
- C 为第三根大码，b 为第三根小码。
- Z 为末根大码，z 为末根小码。

字根输入时:
- 代表根：大码 + 小码 + f
- 附属根：大码 + 小码 + ff

单字输入时：
- 取首、二、三、末根大码。
- 不足四码，末根小码补齐。
- 仍不足四码，首根小码补齐。

详解：
    代表字根：
        - Aaf
    附属根：
        - Aaff
    两根字：
        - ABba
    三根字：
        - ABCc
    四根及四根以上字：
        - ABCZ
    */})
            raw_area.appendChild(span)
        }

        function choose_root(val) {
            clear_tabs_background(val)
            enable_user_input(true)
            raw_area.style.fontSize = "80px"
            raw_area.style.fontHeight = "80px"
            user_input.removeAttribute("disabled")
            user_input.focus()
            total_index = 0
            word_count = 0
            cur_tab = val
            speed_label.innerText = "速度：0.00字/分"

            var all_words
            switch (val) {
                case 1:
                    all_words = get_root_words('a', 'e')
                    break
                case 2:
                    all_words = get_root_words('f', 'j')
                    break
                case 3:
                    all_words = get_root_words('k', 'o')
                    break
                case 4:
                    all_words = get_root_words('p', 't')
                    break
                case 5:
                    all_words = get_root_words('u', 'y')
                    break
                case 6:
                    all_words = get_root_words('a', 'y')
                    break
                case 7:
                    all_words = get_jm_words([0])
                    break
                case 8:
                    all_words = get_jm_words([1])
                    break
                case 9:
                    all_words = get_jm_words([2])
                    break
                case 10:
                    all_words = get_jm_words([3])
                    break
                case 11:
                    all_words = get_jm_words([0, 1])
                    break
                case 12:
                    all_words = get_jm_words([2, 3])
                    break
                case 13:
                    all_words = get_jm_words([0, 2])
                    break
                case 14:
                    all_words = get_jm_words([1, 3])
                    break
                case 15:
                    all_words = get_jm_words([0, 1, 2, 3])
                    break
                default:
                    alert("impossible")
            }

            var option = get_option()
            if (option == 0) {
                total_words = all_words
            } else if (option == 1) {
                var arr = gen_shuttled(all_words.length)
                for (var i = 0; i < arr.length; i++) {
                    arr[i] = all_words[arr[i]]
                }
                total_words = arr
            } else {
                var arr = gen_randoms(get_setup_count("total_count"), 0, all_words.length)
                for (var i = 0; i < arr.length; i++) {
                    arr[i] = all_words[arr[i]]
                }
                total_words = arr
            }
            max_words_count = total_words.length
            wrong_words = []

            next_words()
            key_hint()
            total_label.innerText = "\t进度：0/" + max_words_count + "字"

            reset_timer()
        }

        function timeout() {
            speed_timer = setTimeout("timeout()", 500)
            var speed = 0.0
            var elapsed = new Date().getTime() - start_time
            if (word_count > 0 && elapsed > 0) {
                speed = word_count * 60 * 1000 / elapsed
                speed_label.innerText = "速度：" + speed.toFixed(2) + "字/分"
            }
        }

        function start_timer() {
            if (speed_timer == null) {
                start_time = new Date().getTime()
                timeout()
            }
        }

        function reset_timer() {
            if (speed_timer != null) {
                clearTimeout(speed_timer)
                speed_timer = null
            }
        }

        function get_jm_words(arr) {
            var words = new Array()
            for (idx in arr) {
                var i = arr[idx]
                var objs = jm_map[i]
                for (var key in objs) {
                    words.push({ "key": key, "code": objs[key] })
                }
            }
            return words
        }

        function get_root_words(begch, endch) {
            var words = new Array()
            var achar_code = 'a'.charCodeAt(0)
            var beg = begch.charCodeAt(0) - achar_code
            var end = endch.charCodeAt(0) - achar_code + 1
            for (var i = beg; i < end; i++) {
                var objs = root_map[i]
                var curch = String.fromCharCode(achar_code + beg + i)
                var key = curch + 'v'
                var curobj = objs[key]
                for (var idx in curobj) {
                    words.push({ "key": key, "code": curobj[idx] })
                }
                key = curch + 'u'
                curobj = objs[key]
                for (var idx in curobj) {
                    words.push({ "key": key, "code": curobj[idx] })
                }
                for (var key in objs) {
                    if (key != curch + 'v' && key != curch + 'u') {
                        curobj = objs[key]
                        for (var idx in curobj) {
                            words.push({ "key": key, "code": curobj[idx] })
                        }
                    }
                }
            }
            return words
        }

        function next_words() {
            var last_count = max_words_count - total_index
            if (last_count <= 0 && (!is_repeat_wrong_checked() || wrong_words.length == 0)) {
                return false
            }

            var target_words
            var word_need
            if (last_count <= 0) {
                word_need = wrong_words.length
                target_words = wrong_words
                max_words_count += word_need
                wrong_words = []
            } else {
                word_need = Math.min(last_count, get_setup_count("one_time_count"))
                target_words = total_words.slice(total_index, total_index + word_need)
            }
            cur_input_max = word_need
            cur_input_index = 0
            clear_raw_area()

            for (idx in target_words) {
                var span = document.createElement("span")
                word = target_words[idx]
                span.innerText = word.code + " "
                span.setAttribute("key", word.key)
                span.setAttribute("code", word.code)
                span.id = "word" + idx
                span.style.color = "lightgrey"
                raw_area.appendChild(span)
            }

            total_index += word_need
            return true
        }

        function get_setup_count(id) {
            var node = document.getElementById(id)
            return parseInt(node.value)
        }

        function gen_shuttled(size) {
            var array = new Array()
            for (var i = 0; i < size; i++) {
                array.push(i)
            }
            for (var i = 0; i < size; i++) {
                var idx = Math.floor(Math.random() * size)
                var tmp = array[idx]
                array[idx] = array[i]
                array[i] = tmp
            }
            return array
        }

        function gen_randoms(size, beg, end) {
            var count = end - beg
            var array = new Array()
            for (var i = 0; i < size; i++) {
                array.push(Math.floor(Math.random() * count + beg))
            }
            return array
        }

        function get_option() {
            var radios = document.getElementsByName("radiobutton")
            for (var i = 0; i < radios.length; i++) {
                if (radios[i].checked) {
                    return i
                }
            }
        }

        function is_hint_option_checked() {
            var checked = document.getElementsByName("key_hint_checkbox")[0].checked
            return checked
        }

        function is_repeat_wrong_checked() {
            var checked = document.getElementsByName("repeat_wrong_checkbox")[0].checked
            return checked
        }

        function key_hint() {
            if (user_input.getAttribute("disabled") != "true") {
                if (is_hint_option_checked()) {
                    var word = document.getElementById("word" + cur_input_index)
                    var key = word.getAttribute("key")
                    user_input.setAttribute("placeholder", key)
                } else {
                    user_input.setAttribute("placeholder", "")
                }
            }
        }

        function user_input_change() {
            if (cur_input_index >= cur_input_max)
                return

            var word = document.getElementById("word" + cur_input_index)
            var key = word.getAttribute("key")
            var val = user_input.value
            if (val[val.length - 1] == " " || val[val.length - 1] == ";" || val.length == key.length) {
                if (val.toLowerCase() == key) {
                    start_timer()
                    cur_input_index++
                    word_count++
                    total_label.innerText = "\t进度：" + word_count + "/" + max_words_count + "字"
                    word.style.color = "black"
                    user_input.setAttribute("placeholder", "")
                } else {
                    var code = word.getAttribute("code")
                    var last = wrong_words[wrong_words.length - 1]
                    if (wrong_words.length == 0 || wrong_words.length > 0 && (last["key"] != key || last["code"] != code)) {
                        wrong_words.push({ "key": key, "code": code })
                    }
                    word.style.color = "red"
                    user_input.setAttribute("placeholder", key)
                }
                user_input.value = ""

                if (cur_input_index >= cur_input_max) {
                    if (!next_words()) {
                        user_input.setAttribute("disabled", "true")
                        reset_timer()
                    }
                }

                key_hint()
            }
        }

        function hereDoc(f) {
            return f.toString().replace(/^[^\/]+\/\*!?\s?/, '').replace(/\*\/[^\/]+$/, '');
        }

        function clear_tabs_background(activate_idx) {
            var tabs = document.getElementsByClassName("tab")
            for (var idx in tabs) {
                if (tabs[idx].style)
                    tabs[idx].style.backgroundColor = "#70abe6"
            }
            if (activate_idx != null) {
                var tab = document.getElementById("tab" + activate_idx)
                tab.style.backgroundColor = "white"
            }
        }

        function enable_user_input(val) {
            if (val) {
                user_input.style.display = "block"
                main_top.style.display = "block"

            } else {
                user_input.style.display = "none"
                main_top.style.display = "none"
            }
            user_input.value = ""
        }

        function clear_raw_area() {
            while (raw_area.hasChildNodes()) {
                raw_area.removeChild(raw_area.lastChild);
            }
        }

    </script>
    <style>
        html {
            font-family: '宇浩字根', 'TH-Tshyn-P0', 'TH-Tshyn-P1', 'TH-Tshyn-P2', 'TH-Tshyn-P16', '中华书局宋体00平面', 'sim-ch_n5100', 'Times New Roman', Times, serif;
        }

        aside {
            text-align: center;
            width: 120px;
            height: 60%;
            background-color: #70abe6;
            position: absolute;
            top: 0;
            left: 0;
            font-size: 125%;
            cursor: default;
        }

        .textarea {
            width: 95%;
            min-height: 150px;
            padding-left: 25px;
            padding-top: 25px;
            outline: 0;
            border: none;
            word-wrap: normal;
            overflow-y: visible;
            resize: none;
            border-color: rgba(82, 168, 236, 0.8);
            box-shadow: inset 0 2px 6px rgba(0, 0, 0, 0.3), 0 0 16px rgba(82, 168, 236, 1);
        }

        .spinner,
        #user_input {
            padding: 5px;
            outline: 0;
            border: 2px solid #a0b3d6;
            border-color: rgba(82, 168, 236, 0.8);
            box-shadow: inset 0 2px 6px rgba(0, 0, 0, 0.1), 0 0 16px rgba(82, 168, 236, 0.6);
        }

        .tab:hover {
            background-color: white;
        }

        .tab {
            padding: 6px;
        }

        #content {
            padding-left: 170px;
            padding-top: 10px;
            padding-bottom: 10px;
            padding-right: 10px;
        }

        #maintop {
            padding-left: 170px;
            line-height: 35px;
        }

        #mainbot {
            padding-left: 170px;
            line-height: 1.5;
        }

        #aside_title {
            font-size: 120%;
            padding: 20px;
        }

        #author {
            text-align: center;
            padding: 4px;
            padding-top: 15px;
            color: #70abe6;
        }

        #user_input {
            margin-top: 25px;
            align-self: center;
            height: 150px;
            width: 360px;
            margin-left: 10%;
            align-content: center;
            font-size: 800%;
        }
    </style>
</head>

<body onload="main()">
    <aside>
        <div id="aside_title">宇浩</div>
        <div class="tab" id="tab0" onclick="display_help()">快速入门</div>
        <div class="tab" id="tab1" onclick="choose_root(1)">常用1-50</div>
        <div class="tab" id="tab2" onclick="choose_root(2)">常用51-100</div>
        <div class="tab" id="tab3" onclick="choose_root(3)">常用101-150</div>
        <div class="tab" id="tab4" onclick="choose_root(4)">常用151-200</div>
        <div class="tab" id="tab5" onclick="choose_root(5)">常用201-250</div>
        <div class="tab" id="tab6" onclick="choose_root(6)">全部前250</div>
        <div class="tab" id="tab999" onclick="display_release_note()">更新历史</div>
        <div id="author">作者: MoGu</div>
    </aside>
    <div id="maintop">
        <br>
        <label>单次字根数：</label>
        <input id="one_time_count" class="spinner" type="number" , min="10" , max="500" , value="1">
        <label>练习字根数：</label>
        <input id="total_count" class="spinner" type="number" , min="10" , max="500" , value="200">
        </br>
        <input type="radio" name="radiobutton" onclick="choose_root(cur_tab)" checked="">顺序单次</input>
        <input type="radio" name="radiobutton" onclick="choose_root(cur_tab)">乱序单次</input>
        <input type="radio" name="radiobutton" onclick="choose_root(cur_tab)">乱序重复</input>
        <input type="checkbox" name="key_hint_checkbox" onclick="key_hint()" , checked=1>编码提示</input>
        <input type="checkbox" name="repeat_wrong_checkbox" checked="">错误复习</input>
        <br>
        <label id="totallabel"></label>
        <label id="speedlabel"></label>
        </br>
    </div>
    <div id="content">
        <div class="textarea" , id="raw_area"></div>
        <input id="user_input" oninput="user_input_change()">
    </div>
    <div id="mainbot">
        <p> 学习路线：
            <br>
            <a target="_blank" href="https://zhuyuhao.com/yuhao/practice_50">练习并熟悉最常用的50个字根，一共5遍</a>
            <br>
            <a target="_blank" href="https://zhuyuhao.com/yuhao/practice_100">练习并熟悉最常用的100个字根，一共5遍（85%频率）</a>
            <br>
            <a target="_blank" href="https://zhuyuhao.com/yuhao/practice_characters">练习最常用的250个汉字（65%字频）</a>
            <br>
            <a target="_blank" href="https://zhuyuhao.com/yuhao/practice">练习并熟悉全部字根，每日1遍</a>
        </p>
    </div>
</body>

</html>